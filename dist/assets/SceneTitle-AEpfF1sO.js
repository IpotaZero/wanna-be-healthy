class o{#t=0;#e=[];#s=new AbortController;direction;constructor(e){this.direction=e,this.update()}update(){this.#s.abort(),this.#e=[...document.querySelectorAll("button")].filter(t=>this.#n(t));const e=this.#e.findIndex(t=>t.classList.contains("selected"));this.#t=Math.max(e,0),this.#s=new AbortController,window.addEventListener("keydown",this.#a.bind(this),{signal:this.#s.signal}),this.#r(),this.#i()}discard(){this.#s.abort()}#n(e){for(;e;){const t=getComputedStyle(e);if(t.display==="none"||t.visibility==="hidden"||t.opacity==="0")return!1;if(!e.parentElement)return!0;e=e.parentElement}return!0}#r(){this.#e.forEach((e,t)=>{e.onmouseover=()=>{this.#t=t,this.#i()}})}#a(e){const t=this.#e.length,s=this.direction==="horizontal"?"ArrowRight":"ArrowDown",i=this.direction==="horizontal"?"ArrowLeft":"ArrowUp";e.code===s&&(this.#t=(this.#t+1)%t,this.#i()),e.code===i&&(this.#t=(this.#t+t-1)%t,this.#i()),["Enter","Space","KeyZ"].includes(e.code)&&this.#e[this.#t].click(),["Escape","Backspace","KeyX"].includes(e.code)&&this.#e.find(n=>n.hasAttribute("data-back"))?.click()}#i(){this.#e.forEach((e,t)=>{e.classList.toggle("selected",t===this.#t),t===this.#t&&e.focus()})}}class c{#t=[];#e;#s;#n={};constructor(e,t,s){this.#e=e,this.#e.innerHTML=s,this.#s=[...e.querySelectorAll(".page")],this.#r(t),this.#i(),this.#a()}on(e,t){this.#n[e]=t}#r(e){const t=e.split(" ");this.#t.push(...t.slice(0,-1)),this.#t.push(t.at(-1)),this.#h(t.at(-1),!0)}#a(){this.#e.querySelectorAll("[data-link]").forEach(t=>{const s=t.hasAttribute("data-immediately"),i=t.hasAttribute("data-sever"),n=t.getAttribute("data-link");t.addEventListener("click",()=>{i&&(this.#t=[]),this.#t.push(n),this.#h(n,s)})})}#i(){this.#e.querySelectorAll("[data-back]").forEach(t=>{const s=t.hasAttribute("data-immediately"),i=t.getAttribute("data-back"),n=Number.parseInt(i);if(Number.isNaN(n)||n<=0){console.warn("正しくないdata-back！",t);return}t.addEventListener("click",()=>{if(this.#t.length<=n){console.warn("戻る履歴がない",t);return}let a="";for(let h=0;h<n;h++)this.#t.pop(),a=this.#t[this.#t.length-1];this.#h(a,s)})})}async#h(e,t){const s=this.#e.querySelector(e);if(!s)throw new Error(`そんなpageは無い: ${e}`);t||(await new Promise(i=>{this.#e.style.transition="opacity 200ms",this.#e.style.opacity="0",this.#e.style.pointerEvents="none",setTimeout(i,200)}),this.#e.style.opacity="1",this.#e.style.pointerEvents=""),this.#s.forEach(i=>{i.classList.toggle("hidden",i!==s)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Object.entries(this.#n).forEach(([i,n])=>{e.match(i)&&n()})})})}}class l{end(){}}class d extends l{ready;#t;#e;constructor(){super(),this.ready=this.#s()}async#s(){const e=document.getElementById("container"),t=await fetch("./pages/title.html").then(s=>s.text());this.#e=new c(e,"#normal",t),this.#e.on(".*",()=>{this.#t.update()}),this.#t=new o("horizontal")}end(){this.#t.discard()}}export{d as SceneTitle};
//# sourceMappingURL=SceneTitle-AEpfF1sO.js.map
