const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneNovel-DARaezDN.js","../run.js"])))=>i.map(i=>d[i]);
import{A as c,S as o,B as n,_ as g,a as u}from"../run.js";class y{#e=[];#t;#s;#i={};currentPage;ready;before=()=>{};after=()=>{};constructor(t,e,s){this.#t=t,this.#t.innerHTML=s,this.#s=Array.from(t.querySelectorAll(".page")),this.ready=this.#r(e)}on(t,e){this.#i[t]=e}async#r(t){await this.#n(t),this.#c(),this.#o()}async#n(t){const e=t.split(" ");this.#e.push(...e.slice(0,-1),e.at(-1)),await this.goto(e.at(-1),{msIn:0,msOut:0})}#o(){this.#t.querySelectorAll("[data-link]").forEach(t=>{t.hasAttribute("data-immediately");const e=t.hasAttribute("data-sever"),s=t.getAttribute("data-link");t.addEventListener("click",()=>{e&&(this.#e=[]),this.#e.push(s),this.goto(s)})})}#c(){this.#t.querySelectorAll("[data-back]").forEach(t=>{const e=Number.parseInt(t.getAttribute("data-back"));if(isNaN(e)||e<=0){console.warn("正しくないdata-back！",t);return}t.addEventListener("click",()=>{this.back(e)||console.warn(t)})})}async back(t){if(this.#e.length<=t)return console.warn("戻る履歴がない"),!1;this.#e.splice(-t);const e=this.#e[this.#e.length-1];return this.goto(e),!0}async goto(t,{msIn:e=200,msOut:s=200}={}){const a=this.#t.querySelector(t);if(!a)throw new Error(`そんなpageは無い: ${t}`);this.#a(),this.before(),e>0&&await c.fadeOut(this.#t,e),this.#s.forEach(i=>i.classList.toggle("hidden",i!==a)),this.currentPage=a,requestAnimationFrame(()=>{requestAnimationFrame(()=>{Object.entries(this.#i).forEach(([i,h])=>{t.match(i)&&h()}),this.#h(),this.after()})}),s>0&&await c.fadeIn(this.#t,s)}#a(){this.#t.querySelectorAll("button").forEach(t=>{t.disabled=!0})}#h(){this.#t.querySelectorAll("button").forEach(t=>{t.disabled=!1})}}class f{async end(){}}class d{static day=0;static yami=0;static usedMedicine=!1;static dark=!1;static reset(){this.day=0,this.dark=!1,this.usedMedicine=!1,this.yami=0}static display(t){t.innerHTML+=`
            <div id="state">
                ${this.day+1}にちめ
                <div id="yami-area">
                   <span>やみ゜: </span>
                   <span id="yami"></span>
                </div>
            </div>
        `,t.querySelector("#yami").style.width=`${this.yami*23/2}%`}}class m{#e=new AbortController;#t=0;#s=[];#i=new Set;direction;isAvailable=!0;constructor(t){this.direction=t,this.update(),window.addEventListener("keydown",this.#o,{signal:this.#e.signal}),window.addEventListener("keyup",this.#c,{signal:this.#e.signal})}update(){this.#s=Array.from(document.querySelectorAll("button")).filter(this.#r);const t=this.#s.findIndex(e=>e.classList.contains("selected"));this.#t=Math.max(t,0),this.#n(),this.#a()}discard(){this.#e.abort()}#r=t=>{for(;t;){const e=getComputedStyle(t);if(e.display==="none"||e.visibility==="hidden")return!1;t=t.parentElement}return!0};#n(){this.#s.forEach((t,e)=>{t.onmouseover=()=>{this.#t=e,this.#a()}})}#o=t=>{if(!this.isAvailable||this.#i.has(t.code))return;this.#i.add(t.code),o.key.play();const e=this.#s.length;if(e===0)return;const s=this.direction==="horizontal"?"ArrowRight":"ArrowDown",a=this.direction==="horizontal"?"ArrowLeft":"ArrowUp";t.code===s?(this.#t=(this.#t+1)%e,this.#a()):t.code===a?(this.#t=(this.#t+e-1)%e,this.#a()):["Enter","Space","KeyZ"].includes(t.code)?this.#s[this.#t].click():["Escape","Backspace","KeyX"].includes(t.code)&&this.#s.find(i=>i.hasAttribute("data-back"))?.click()};#c=t=>{this.#i.delete(t.code)};#a(){this.#s.forEach((t,e)=>{t.classList.toggle("selected",e===this.#t),e===this.#t&&t.focus()})}}class w{constructor(t,e,s){this.canvas=t,this.gainNode=e,this.ctx=t.getContext("2d"),this.analyser=s.createAnalyser(),this.analyser.fftSize=2048,this.bufferLength=this.analyser.fftSize,this.dataArray=new Uint8Array(this.bufferLength),this.gainNode.connect(this.analyser)}ctx;analyser;dataArray;bufferLength;update(){this.analyser.getByteTimeDomainData(this.dataArray);const{width:t,height:e}=this.canvas;this.ctx.clearRect(0,0,t,e),this.ctx.lineWidth=2,this.ctx.strokeStyle="#888",this.ctx.beginPath();const s=t/this.bufferLength;let a=0;for(let i=0;i<this.bufferLength;i++){const l=this.dataArray[i]/128*e/2;i===0?this.ctx.moveTo(a,l):this.ctx.lineTo(a,l),a+=s}this.ctx.lineTo(t,e/2),this.ctx.stroke()}}class v{page;constructor(t){this.page=t,window.addEventListener("keydown",this.#e.bind(this))}#e(t){t.key==="ArrowDown"?(this.page.scrollBy({top:this.#t(),behavior:"instant"}),t.preventDefault()):t.key==="ArrowUp"&&(this.page.scrollBy({top:-this.#t(),behavior:"instant"}),t.preventDefault())}#t(){const t=getComputedStyle(this.page).fontSize;return parseFloat(t)||16}discard(){window.removeEventListener("keydown",this.#e)}}class p extends f{ready;#e;#t;#s;#i;#r;#n=performance.now();constructor(){super(),this.ready=this.#o()}async#o(){const t=document.getElementById("container"),e=await fetch("./pages/title.html").then(i=>i.text());this.#s=new y(t,"#normal",e),await this.#s.ready;const s=d.dark?-100:0;await n.fetch("assets/sounds/title.mp3",{loopStart:42,volume:2,detune:s}),n.play();const a=t.querySelector("canvas");this.#i=new w(a,n.gain,n.context),this.#s.after=()=>{this.#e.update(),this.#t.page=this.#s.currentPage},this.#e=new m("horizontal"),this.#t=new v(this.#s.currentPage),this.#c(),this.#r=setInterval(this.#a.bind(this))}#c(){document.querySelector("#game").onclick=async()=>{d.reset();const{SceneNovel:t}=await g(async()=>{const{SceneNovel:e}=await import("./SceneNovel-DARaezDN.js");return{SceneNovel:e}},__vite__mapDeps([0,1]),import.meta.url);n.fadeOut(1e3),u.goto(()=>new t(!0),{msIn:1e3,msOut:1e3})}}async end(){this.#e.discard(),this.#t.discard(),clearInterval(this.#r)}#a(){performance.now()-this.#n>=25500&&this.#i.update()}}const A=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:p},Symbol.toStringTag,{value:"Module"}));class b extends f{ready;#e;constructor(){super(),this.ready=this.#t()}async#t(){const t=document.getElementById("container"),e=await fetch("./pages/pretitle.html").then(s=>s.text());this.#e=new y(t,"#pretitle",e),this.#s()}async#s(){await c.ok(),o.key.play(),await c.sleep(o.key.duration*1e3),o.MCR.play(),u.goto(()=>new p,{msIn:1500,msOut:800})}}const k=Object.freeze(Object.defineProperty({__proto__:null,ScenePretitle:b},Symbol.toStringTag,{value:"Module"}));export{m as K,y as P,f as S,d as a,A as b,k as c};
//# sourceMappingURL=ScenePretitle-igXtx3ht.js.map
