const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneNight-COG9Xl4u.js","../run.js","./ScenePretitle-igXtx3ht.js","./SceneMedicine-DuDgYaZ5.js"])))=>i.map(i=>d[i]);
import{I as p,B as r,A as i,E as l,S as d,_ as u,a as m}from"../run.js";import{S as y,a as o,P as g}from"./ScenePretitle-igXtx3ht.js";class w{#a=document.getElementById("form");#e=document.getElementById("input");#t=document.getElementById("question");ready;#s;#n=0;onClear=()=>{};onStart=()=>{};constructor(t){this.#s=t,console.log(this.#s),this.#a.onsubmit=e=>{e.preventDefault(),this.#e.value===this.#t.textContent&&(this.onClear(),this.#i())},this.ready=new Promise(e=>{this.#e.addEventListener("focus",()=>{this.#e.style.cursor="none",this.onStart(),this.#i(),e()},{once:!0})})}finish(){this.#e.readOnly=!0}#i(){this.#e.value="";let t=0;do t=Math.floor(Math.random()*this.#s.length);while(t===this.#n);this.#n=t,this.#t.textContent=this.#s[t],this.#e.placeholder=this.#s[t]}}class v extends y{ready;#a;#e;#t;constructor(){super(),p.isAvailable=!1,this.ready=this.#s()}async end(){}async#s(){const t=o.dark?-100:0,[e,a,s]=await Promise.all([fetch("pages/day.html"),r.fetch(`assets/sounds/stage-${~~(o.day/2)}.mp3`,{loop:!1,detune:t}),fetch(`assets/typing/stage-${o.day}.csv`)]),n=document.getElementById("container");this.#a=new g(n,"#day",await e.text()),o.display(n.querySelector("sub")),this.#n(await s.text())}async#n(t){await i.ok(),await this.#a.goto("#game",{msIn:600});let e=0;const a=document.getElementById("score"),s=new l("ノートをとれ!",d.voice);s.classList.add("text"),document.querySelector("#container #game").appendChild(s),this.#t=new w(t.split(`
`)),this.#t.onStart=()=>{s.remove()};const n=document.getElementById("nemu");this.#t.onClear=()=>{e++,a.textContent=`Score: ${e}`,a.classList.remove("up"),n.classList.remove("up"),requestAnimationFrame(async()=>{a.classList.add("up"),n.classList.add("up"),await i.sleep(400),n.classList.remove("up")})},await this.#t.ready,r.play(),r.source.onended=()=>{this.#t.finish(),this.#i(e)};const c=document.getElementById("gauge");c.style.transition=`transform ${r.source?.buffer?.duration??1}s linear`,c.style.transform="scaleX(0)"}async#i(t){const e=new l(`ねむけレベル: ${t}`,d.voice);if(e.classList.add("text"),document.querySelector("#container #game").appendChild(e),await Promise.race([i.sleep(1e3),i.ok()]),await i.ok(),o.dark){const{SceneNight:a}=await u(async()=>{const{SceneNight:s}=await import("./SceneNight-COG9Xl4u.js").then(n=>n.am);return{SceneNight:s}},__vite__mapDeps([0,1,2]),import.meta.url);m.goto(()=>new a(0))}else{const{SceneMedicine:a}=await u(async()=>{const{SceneMedicine:s}=await import("./SceneMedicine-DuDgYaZ5.js");return{SceneMedicine:s}},__vite__mapDeps([3,1,2]),import.meta.url);m.goto(()=>new a(t))}}}export{v as SceneDay};
//# sourceMappingURL=SceneDay-DWnHwZdp.js.map
