const b="modulepreload",E=function(i,e){return new URL(i,e).href},v={},k=function(e,t,s){let o=Promise.resolve();if(t&&t.length>0){let w=function(r){return Promise.all(r.map(l=>Promise.resolve(l).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const n=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),d=a?.nonce||a?.getAttribute("nonce");o=w(t.map(r=>{if(r=E(r,s),r in v)return;v[r]=!0;const l=r.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(!!s)for(let p=n.length-1;p>=0;p--){const y=n[p];if(y.href===r&&(!l||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${f}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":b,l||(c.as="script"),c.crossOrigin="",c.href=r,d&&c.setAttribute("nonce",d),document.head.appendChild(c),l)return new Promise((p,y)=>{c.addEventListener("load",p),c.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${r}`)))})}))}function h(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return o.then(n=>{for(const a of n||[])a.status==="rejected"&&h(a.reason);return e().catch(h)})};class g{static fadeOut(e,t=200){return e.style.pointerEvents="none",e.style.transition=`opacity ${t}ms steps(10, end)`,e.style.opacity="0",this.sleep(t)}static async fadeIn(e,t=200){return e.style.pointerEvents="",e.style.transition=`opacity ${t}ms steps(10, end)`,e.style.opacity="1",this.sleep(t)}static sleep(e){return new Promise(t=>{setTimeout(t,e)})}static ok(){const e=new AbortController;return new Promise(t=>{document.addEventListener("click",()=>{e.abort(),t()},{signal:e.signal}),document.addEventListener("keydown",s=>{["KeyZ","Enter","Space"].includes(s.code)&&(e.abort(),t())},{signal:e.signal})})}static key(){const e=new AbortController;return new Promise(t=>{document.addEventListener("click",()=>{e.abort(),t()},{signal:e.signal}),document.addEventListener("keydown",s=>{e.abort(),t()},{signal:e.signal})})}}class S{static#e;static init(e){this.#e=e}static async goto(e,{showLoading:t=this.#t,hideLoading:s=this.#s,msIn:o=200,msOut:h=200}={}){const n=document.getElementById("container");await g.fadeOut(n,o),await this.#e.end();let a=!1,d=!1;g.sleep(1e3).then(()=>{a||(t(),d=!0)}),this.#e=e(),await this.#e.ready,a=!0,d&&s(),await g.fadeIn(n,h)}static#t(){const e=document.createElement("p");e.textContent="Loading...",e.classList.add("loading"),document.body.appendChild(e)}static#s(){document.querySelectorAll(".loading").forEach(e=>e.remove())}}class L{static context;static gain;static source=null;static#e=.3;static#t=!1;static init(){if(this.#t)throw new Error("すでにinitialized!");this.#t=!0,this.context=new AudioContext,this.gain=this.context.createGain(),this.gain.connect(this.context.destination)}static async fetch(e,{loopStart:t,loopEnd:s,loop:o,volume:h,detune:n}={}){this.source?.stop(),this.source?.disconnect(),this.pause(),this.#s(this.#e*(h??1));const d=await(await fetch(e)).arrayBuffer(),w=await this.context.decodeAudioData(d);this.source=this.context.createBufferSource(),this.source.buffer=w,this.source.loop=o??!0,this.source.loopStart=t??0,this.source.loopEnd=s??this.source.buffer.duration,n!==void 0&&(this.source.detune.value=n),this.source.connect(this.gain),this.source.start()}static async play(){await this.context.resume()}static async pause(){await this.context.suspend()}static async fadeOut(e){await this.fade(0,e),this.pause()}static async fade(e,t){this.gain.gain.cancelScheduledValues(this.context.currentTime),this.gain.gain.linearRampToValueAtTime(e,this.context.currentTime+t/1e3),await new Promise(s=>setTimeout(()=>s(),t))}static#s(e){this.gain.gain.cancelScheduledValues(0),this.gain.gain.value=e}}class m{static isAvailable=!0;static keyboard={pressed:new Set,longPressed:new Set,pushed:new Set,upped:new Set};static mouse={position:{x:0,y:0},clicked:new Set,upped:new Set,down:new Set,about:new Set};static focusState={isFocused:!0,justFocused:!1,justBlurred:!1};static#e=!1;static init(){if(this.#e)throw new Error("Input is already initialized!");this.#e=!0,document.addEventListener("contextmenu",e=>(e.preventDefault(),e.stopPropagation(),!1)),document.addEventListener("keydown",e=>{if(e.code==="Tab")return e.preventDefault(),e.stopPropagation(),!1}),document.addEventListener("pointerdown",this.#i.bind(this),{passive:!1}),document.addEventListener("pointermove",this.#a.bind(this),{passive:!1}),document.addEventListener("pointerleave",this.#n.bind(this),{passive:!1}),document.addEventListener("pointercancel",this.#n.bind(this),{passive:!1}),document.addEventListener("keydown",this.#t.bind(this)),document.addEventListener("keyup",this.#s.bind(this)),window.addEventListener("blur",this.#r.bind(this)),window.addEventListener("focus",this.#c.bind(this)),document.addEventListener("visibilitychange",this.#d.bind(this))}static update(){this.#e||console.error("Input is not initialized!"),this.keyboard.longPressed.clear(),this.keyboard.pushed.clear(),this.keyboard.upped.clear(),this.mouse.clicked.clear(),this.mouse.upped.clear(),this.focusState.justFocused=!1,this.focusState.justBlurred=!1,this.isAvailable||(this.mouse.down.clear(),this.keyboard.pressed.clear())}static#t(e){this.isAvailable&&(e.preventDefault(),this.keyboard.pressed.has(e.code)||this.keyboard.pushed.add(e.code),this.keyboard.pressed.add(e.code),this.keyboard.longPressed.add(e.code))}static#s(e){this.isAvailable&&(e.preventDefault(),this.keyboard.pressed.delete(e.code),this.keyboard.upped.add(e.code))}static#i(e){this.isAvailable&&(this.mouse.down.add("left"),this.mouse.clicked.add("left"),this.#o())}static#a(e){this.isAvailable}static#n(e){this.isAvailable&&(this.mouse.down.delete("left"),this.mouse.upped.add("left"))}static#o(){this.mouse.about.clear();const{x:e,y:t}=this.mouse.position,s=window.innerWidth,o=window.innerHeight;e<s/3?this.mouse.about.add("left"):e>s*2/3&&this.mouse.about.add("right"),t<o/3?this.mouse.about.add("up"):t>o*2/3&&this.mouse.about.add("down"),e>=s/3&&e<=s*2/3&&t>=o/3&&t<=o*2/3&&this.mouse.about.add("center")}static#r(){console.log("よそ見するにゃ!"),this.focusState.isFocused=!1,this.focusState.justBlurred=!0}static#c(){console.log("こっち見んにゃ!"),this.focusState.isFocused=!0,this.focusState.justFocused=!0}static#d(){document.visibilityState==="visible"?this.#c():this.#r()}}(i=>{i.mouseButtons=["left","middle","right","back","forward"],i.keys=["KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape","Backspace","Tab","Space","ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight","CapsLock","NumLock","ScrollLock","Insert","Delete","Home","End","PageUp","PageDown","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ContextMenu","Pause","PrintScreen"],i.directions=["left","right","up","down","center"]})(m||(m={}));const{keyboard:P,focusState:x,mouse:D}=m;class u{#e;constructor(e,t=1){this.#e=new Audio(e),this.#e.volume=t}get duration(){return this.#e.duration}play(){this.#e.currentTime=0,this.#e.play()}setVolume(e){this.#e.volume=e}}class F{static click=new u("assets/sounds/クリック.mp3");static voice=new u("assets/sounds/select.wav",.5);static damage=new u("assets/sounds/damage.mp3",.3);static MCR=new u("assets/sounds/MCR.wav",.3);static key=new u("assets/sounds/キーボード1.mp3",.8);static pakipaki=new u("assets/sounds/pakipaki.mp3",1);static setVolume(e){Object.values(this).forEach(t=>{t.setVolume(e)})}}class K extends HTMLElement{#e;#t=0;#s;#i;onEnd=()=>{};#a;end;isEnd=!1;constructor(e,t){super(),this.hasAttribute("se")?this.#i=new u(this.getAttribute("se")):this.#i=t,this.#s=e??this.innerText,this.innerText="",this.reset()}reset(){this.#t=0,this.innerText="",this.#e=setInterval(this.#o.bind(this),1e3/30),this.isEnd=!1,this.end=new Promise(e=>{this.#a=e})}finish(){this.textContent=this.#s,this.#n()}#n(){this.onEnd(),this.isEnd=!0,this.#a(),clearInterval(this.#e)}#o(){this.textContent+=this.#s[this.#t++]??"",this.#t%2===0&&this.#i?.play(),this.#t>=this.#s.length&&this.#n()}}customElements.define("i-typing",K);document.addEventListener("DOMContentLoaded",async()=>{L.init(),m.init();const{ScenePretitle:i}=await k(async()=>{const{ScenePretitle:e}=await import("./assets/ScenePretitle-igXtx3ht.js").then(t=>t.c);return{ScenePretitle:e}},[],import.meta.url);S.init(new i)});export{g as A,L as B,K as E,m as I,F as S,k as _,S as a,P as k};
//# sourceMappingURL=run.js.map
